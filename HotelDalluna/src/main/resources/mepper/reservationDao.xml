<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.java.dao.InterfaceDao">
	
	<!-- 예약이 되어있나 체크 -->
	<select id="reservationCheck" parameterType="com.java.dto.ReservationDTO" resultType="int">
			select count(*) from reservation r join reservation_number_people p 
		on 
			r.reservation_number = p.reservation_number where room_type in(#{room_type}) 
		and 
			(#{reservation_date_in} between reservation_date_in and reservation_date_out 
		or 
			#{reservation_date_out} between reservation_date_in and reservation_date_out)
	</select>
	
	<!-- 룸 가격 확인 -->
	<select id="roomprices" parameterType="com.java.dto.ReservationDTO" resultType="String">
		select room_prices from room_information where room_type = #{room_type}
	</select>
	
	<insert id="reservationPeople" parameterType="com.java.dto.ReservationDTO" >
		insert into reservation_number_people 
			(reservation_number,room_type, adult,child) 
		values 
			(#{reservation_number}, #{room_type}, #{adult}, #{child}) 
	</insert>
	
	<!--  예약 하기 --> 
	<insert id="reservation" parameterType="com.java.dto.ReservationDTO" >
		insert into 
			reservation(reservation_number,customer_id,reservation_date_in,reservation_date_out, price) 
		values
			(#{reservation_number},#{customer_id},#{reservation_date_in},#{reservation_date_out},#{price})
	</insert>
	
	<!-- 예약 취소 -->
	<delete id="reservationCancell" >
	 		delete from 
	 			reservation_number_people 
	 		where 
	 			reservation_number=#{reservation_number}
	</delete>
	
	<!-- 예약 완료 후 확인 -->
	
	<select id="reservationConfirm" parameterType="string" resultType="com.java.dto.ReservationDTO">
	<![CDATA[
		select 
			r.CUSTOMER_ID,r.RESERVATION_DATE_IN,r.RESERVATION_DATE_OUT,r.price,p.RESERVATION_NUMBER,p.ROOM_TYPE,p.ADULT,p.CHILD
		from 
			reservation r join reservation_number_people p 
		ON 
			r.reservation_number = p.reservation_number 
		where 
			customer_id=#{customer_id}
			]]>  
	</select>
	 

</mapper>
